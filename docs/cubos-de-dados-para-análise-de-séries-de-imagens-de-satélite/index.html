<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1"><title>Cubos de dados para análise de séries de imagens de satélite - Vinicio Coelho Lima</title>
<meta property="og:title" content="Cubos de dados para análise de séries de imagens de satélite - Vinicio Coelho Lima">
<meta property="og:type" content="article">


<meta property="og:image" content="">

<meta property="og:url" content="https://viniciovcl.github.io/viniciovcl/cubos-de-dados-para-an%C3%A1lise-de-s%C3%A9ries-de-imagens-de-sat%C3%A9lite/"><meta property="og:description" content="Página pessoal">
<meta name="Description" property="description" content="Página pessoal">


<meta property="keywords" content ="time-series, image-processing, cube-raster, changedetection, gdalcubes, r-markdown">



<link rel="stylesheet" href="https://viniciovcl.github.io/viniciovcl/css/style.min.css">

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link href="https://viniciovcl.github.io/viniciovcl/index.xml" type="application/atom+xml" rel="alternate" title="Sitewide Atom feed" />
<meta name="theme-color" content="#ffffff">


<script>function updateMode(){localStorage.theme==="dark"||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}function toggleMode(){localStorage.theme==="dark"?localStorage.theme="light":localStorage.theme="dark",updateMode()}window.onload=updateMode();function toggleMenu(){let e=document.getElementById("navbar-default");e.classList.contains("hidden")?e.classList.remove("hidden"):e.classList.add("hidden")}</script>




<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            delimiters: [
                {left: "$$", right: "$$", display: true},
                {left: "$", right: "$", display: false}
            ]
        });
    });
</script>

  </head>
  <body>
    <header class="md:px-0 px-2">
        <nav >
  <div class="container flex flex-wrap justify-between items-center mx-auto">
    <div class="nav-main my-2.5">
      <a href="https://viniciovcl.github.io/viniciovcl/" class="nav-title py-2.5 text-2xl
               text-zinc-600 dark:text-zinc-300 hover:border-b-0">Vinicio Coelho Lima</a>
    </div>
    <button type="button"
            onclick="toggleMenu()"
            class="inline-flex items-center p-2 ml-3
                  text-sm text-gray-500
                  rounded-lg md:hidden hover:bg-gray-100
                  focus:outline-none focus:ring-2
                  focus:ring-gray-200 dark:text-gray-400
                  dark:hover:bg-gray-700 dark:focus:ring-gray-600"
            aria-controls="navbar-default"
            aria-expanded="false">
        <span class="sr-only">Open main menu</span>
        <svg class="w-6 h-6" aria-hidden="true" fill="currentColor"
             viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1
                           0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0
                           01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0
                           01-1-1z" clip-rule="evenodd"></path>
        </svg>
    </button>
    <div class="hidden w-full md:block md:w-auto" id="navbar-default">
      <ul class="grid md:grid-flow-col items-center justify-between text-lg
                 my-2.5 grid-cols-1 pl-0 text-center">
        
        <li class="p-2.5 md:first:pl-0 md:border-none border-b dark:border-zinc-500 list-none">
          <a class="text-zinc-600 dark:text-zinc-300
                    hover:border-b-0" href="/viniciovcl/post/">Posts</a>
        </li>
        
        <li class="p-2.5 md:first:pl-0 md:border-none border-b dark:border-zinc-500 list-none">
          <a class="text-zinc-600 dark:text-zinc-300
                    hover:border-b-0" href="/viniciovcl/tags/">Interesses</a>
        </li>
        
        <li class="p-2.5 md:first:pl-0 md:border-none border-b dark:border-zinc-500 list-none">
          <a class="text-zinc-600 dark:text-zinc-300
                    hover:border-b-0" href="/viniciovcl/about/">contato</a>
        </li>
        
        <li class="h-7 pl-2.5 pr-0 list-none">
          <button type="button" onclick="toggleMode()" class="h-full"  aria-label="Toggle between dark and light mode">
            <img class="h-7 w-7 max-h-full mb-1.5 p-1.5 hidden dark:inline"
                 id="ligh-mode-button-img"
                 alt="A sun icon for switching to light mode"
                 src="https://viniciovcl.github.io/viniciovcl/img/light_mode.svg">
            <img class="h-7 w-7 max-h-full mb-1.5 p-1.5 inline dark:hidden"
                 id="dark-mode-button-img"
                 alt="A moon icon for switching to dark mode"
                 src="https://viniciovcl.github.io/viniciovcl/img/dark_mode.svg">
          </button>
        </li>
      </ul>
    </div>
  </div>
</nav>


    </header>
    <main class="content h-card container mt-2 m-auto
                 leading-loose md:px-0 px-2 z-0"
          role="main">
    
<article class="article h-entry" itemprop="mainEntity" itemscope itemtype="http://schema.org/BlogPosting">
    <div class="title-container">
        <h1 class="article-title p-name" itemprop="name">Cubos de dados para análise de séries de imagens de satélite</h1>
        
        <div class="flex justify-between items-center">
            
            <a class="text-lg text-gray-600 dark:text-gray-400 border-none u-url" href="https://viniciovcl.github.io/viniciovcl/cubos-de-dados-para-an%C3%A1lise-de-s%C3%A9ries-de-imagens-de-sat%C3%A9lite/">
                <time itemprop="datePublished" class="dt-published"
                    datetime="2024-02-18T00:00:00Z"
                    content="2024-02-18T00:00:00Z">
                    2024.02.18
                </time>
            </a>
            
            
                
                <a class="text-gray-600 dark:text-gray-400 text-right border-none p-author h-card" rel="author" href="https://viniciovcl.github.io/viniciovcl/" itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Vinicio C. Lima </span></a>
                
            
        </div>
        
    </div>

    <div class="article-content e-content" itemprop="articleBody">
        <p>No contexto de sensoriamento remoto e observação da Terra, <em>spatiotemporal array</em> refere-se a matrizes multidimensionais onde duas dimensões representam as dimensões  espaciais do raster e o terceiro o tempo (ou a banda). Essa abordagem permite otimizar o acesso e a recuperação de informações específicas em determinados momentos ou locais para séries espaço-temporais.</p>
<img src="./images/fig-cube-1.png" width="60%" style="display: block; margin: auto;" />
<p>Na estrutura de um cubo de dados raster também são considerados cubos de dimensões superiores (hipercubos), como um cubo de cinco dimensões onde, além do tempo, a banda espectral e o sensor formam dimensões.</p>
<img src="./images/cube.png" width="100%" style="display: block; margin: auto;" />
<p>É uma estrutura eficiente para a manipulação de séries temporais de dados raster, permitindo declarar operações algébricas e aplicar funções a um conjunto limitado de dimensões para realizar cálculos e transformações pixel a pixel e criar novas representações dos dados.</p>
<p>Como exemplo utilizei a biblioteca gdalcubes para analisar um conjunto de imagens do sensor MSI a bordo dos satélites Sentinel-2A e Sentinel-2B.</p>
<h2 id="conjunto-de-dados">Conjunto de dados</h2>
<p>O conjunto de dados contém 19 cenas de uma área de Cerrado do Estado de Mato Grosso do Sul adquiridas entre fevereiro e julho de 2020.</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>path_file &lt;- <span style="color:#ed9d13">&#34;/home/vinicio/Documentos/Codigo/TS_gdalcubes/Sentinel2_15bands/&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>s2_files &lt;- <span style="color:#447fcf">list.files</span>( <span style="color:#447fcf">paste</span>(path_file,  <span style="color:#ed9d13">&#34;raw&#34;</span>, sep=<span style="color:#ed9d13">&#34;/&#34;</span>),
</span></span><span style="display:flex;"><span>    pattern = <span style="color:#ed9d13">&#34;.zip$&#34;</span>, recursive = <span style="color:#6ab825;font-weight:bold">TRUE</span> )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>s2_files
</span></span></code></pre></div><pre tabindex="0"><code>##  [1] &#34;S2A_MSIL2A_20200215T134201_N0214_R124_T22KCD_20200215T161217.zip&#34;
##  [2] &#34;S2A_MSIL2A_20200306T134211_N0214_R124_T22KCD_20200306T160502.zip&#34;
##  [3] &#34;S2A_MSIL2A_20200316T134211_N0214_R124_T22KCD_20200316T192808.zip&#34;
##  [4] &#34;S2A_MSIL2A_20200326T134211_N0214_R124_T22KCD_20200326T160948.zip&#34;
##  [5] &#34;S2A_MSIL2A_20200405T134211_N0214_R124_T22KCD_20200405T161002.zip&#34;
##  [6] &#34;S2A_MSIL2A_20200425T134211_N0214_R124_T22KCD_20200425T161132.zip&#34;
##  [7] &#34;S2A_MSIL2A_20200614T134221_N0214_R124_T22KCD_20200614T174720.zip&#34;
##  [8] &#34;S2A_MSIL2A_20200714T134221_N0214_R124_T22KCD_20200714T210626.zip&#34;
##  [9] &#34;S2B_MSIL2A_20200311T134209_N0214_R124_T22KCD_20200311T204936.zip&#34;
## [10] &#34;S2B_MSIL2A_20200331T134209_N0214_R124_T22KCD_20200331T173754.zip&#34;
## [11] &#34;S2B_MSIL2A_20200410T134209_N0214_R124_T22KCD_20200410T174302.zip&#34;
## [12] &#34;S2B_MSIL2A_20200420T134209_N0214_R124_T22KCD_20200420T174701.zip&#34;
## [13] &#34;S2B_MSIL2A_20200430T134209_N0214_R124_T22KCD_20200430T160218.zip&#34;
## [14] &#34;S2B_MSIL2A_20200510T134209_N0214_R124_T22KCD_20200510T174712.zip&#34;
## [15] &#34;S2B_MSIL2A_20200520T134209_N0214_R124_T22KCD_20200520T173910.zip&#34;
## [16] &#34;S2B_MSIL2A_20200530T134209_N0214_R124_T22KCD_20200530T155919.zip&#34;
## [17] &#34;S2B_MSIL2A_20200609T134219_N0214_R124_T22KCD_20200609T174956.zip&#34;
## [18] &#34;S2B_MSIL2A_20200619T134219_N0214_R124_T22KCD_20200619T175114.zip&#34;
## [19] &#34;S2B_MSIL2A_20200719T134209_N0214_R124_T22KCD_20200719T174410.zip&#34;
</code></pre><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>files.size &lt;- <span style="color:#447fcf">sum</span>(<span style="color:#447fcf">file.size</span>(s2_files)) / <span style="color:#3677a9">1000</span>^3 <span style="color:#999;font-style:italic"># gigabytes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>files.size <span style="color:#999;font-style:italic"># gigabytes</span>
</span></span></code></pre></div><pre tabindex="0"><code>## [1] 21.2
</code></pre><h2 id="gdalcubes">gdalcubes</h2>
<p><a href="https://gdalcubes.github.io/">gdalcubes</a> é um pacote R e uma biblioteca C++ para o processamento de grandes coleções de imagens de satélite.</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#447fcf">library</span>(magrittr)
</span></span><span style="display:flex;"><span><span style="color:#447fcf">library</span>(gdalcubes)
</span></span><span style="display:flex;"><span><span style="color:#447fcf">packageVersion</span>(<span style="color:#ed9d13">&#34;gdalcubes&#34;</span>)
</span></span></code></pre></div><pre tabindex="0"><code>## [1] &#39;0.7.0&#39;
</code></pre><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Cria uma coleção de imagens gdalcubes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#447fcf">if</span>(!<span style="color:#447fcf">file.exists</span>(<span style="color:#447fcf">file.path</span>(path_file, <span style="color:#ed9d13">&#34;S2_collection.db&#34;</span> ))){
</span></span><span style="display:flex;"><span> S2_download_zip = <span style="color:#447fcf">list.files</span>( <span style="color:#447fcf">paste</span>(path_file, <span style="color:#ed9d13">&#34;raw&#34;</span>, sep = <span style="color:#ed9d13">&#34;/&#34;</span>),
</span></span><span style="display:flex;"><span>                     pattern = <span style="color:#ed9d13">&#34;.zip$&#34;</span>,  full.names = <span style="color:#6ab825;font-weight:bold">TRUE</span>, recursive = <span style="color:#6ab825;font-weight:bold">TRUE</span> )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#447fcf">create_image_collection</span>(
</span></span><span style="display:flex;"><span>   files = S2_download_zip, format=<span style="color:#ed9d13">&#39;Sentinel2_L2A&#39;</span>,
</span></span><span style="display:flex;"><span>   unroll_archives=<span style="color:#6ab825;font-weight:bold">TRUE</span>, out_file=<span style="color:#447fcf">file.path</span>(
</span></span><span style="display:flex;"><span>     path_file,  <span style="color:#ed9d13">&#34;S2_collection.db&#34;</span>))
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>S2_collection &lt;- <span style="color:#447fcf">image_collection</span>(<span style="color:#447fcf">file.path</span>(
</span></span><span style="display:flex;"><span>  path_file, <span style="color:#ed9d13">&#34;S2_collection.db&#34;</span>))  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>S2_collection
</span></span></code></pre></div><pre tabindex="0"><code>## Image collection object, referencing 19 images with 15 bands
## Images:
##                                                           name      left
## 1 S2A_MSIL2A_20200215T134201_N0214_R124_T22KCD_20200215T161217 -52.91137
## 2 S2A_MSIL2A_20200306T134211_N0214_R124_T22KCD_20200306T160502 -52.91137
## 3 S2A_MSIL2A_20200316T134211_N0214_R124_T22KCD_20200316T192808 -52.91137
## 4 S2A_MSIL2A_20200326T134211_N0214_R124_T22KCD_20200326T160948 -52.91137
## 5 S2A_MSIL2A_20200405T134211_N0214_R124_T22KCD_20200405T161002 -52.91137
## 6 S2A_MSIL2A_20200425T134211_N0214_R124_T22KCD_20200425T161132 -52.91137
##         top    bottom     right            datetime        srs
## 1 -18.98277 -19.98271 -51.85693 2020-02-15T13:42:01 EPSG:32722
## 2 -18.98277 -19.98271 -51.85693 2020-03-06T13:42:11 EPSG:32722
## 3 -18.98277 -19.98271 -51.85693 2020-03-16T13:42:11 EPSG:32722
## 4 -18.98277 -19.98271 -51.85693 2020-03-26T13:42:11 EPSG:32722
## 5 -18.98277 -19.98271 -51.85693 2020-04-05T13:42:11 EPSG:32722
## 6 -18.98277 -19.98271 -51.85693 2020-04-25T13:42:11 EPSG:32722
## [ omitted 13 images ] 
## 
## Bands:
##    name offset scale unit   nodata image_count
## 1   AOT      0 1e+00                        19
## 2   B01      0 1e-04      0.000000          19
## 3   B02      0 1e-04      0.000000          19
## 4   B03      0 1e-04      0.000000          19
## 5   B04      0 1e-04      0.000000          19
## 6   B05      0 1e-04      0.000000          19
## 7   B06      0 1e-04      0.000000          19
## 8   B07      0 1e-04      0.000000          19
## 9   B08      0 1e-04      0.000000          19
## 10  B09      0 1e-04      0.000000          19
## 11  B11      0 1e-04      0.000000          19
## 12  B12      0 1e-04      0.000000          19
## 13  B8A      0 1e-04      0.000000          19
## 14  SCL      0 1e+00                        19
## 15  WVP      0 1e+00                        19
</code></pre><p>Uma view define a geometria espaço-temporal sem conectá-la ao conjuntos de dados específicos. Isso é especialmente útil quando se trabalha com grandes volumes de dados raster. É uma representação específica da série temporal que pode ser definida pela geometria do cubo.</p>
<p>Uma view do cubo de dados contém o sistema de referência espacial (SRS), a extensão espaçotemporal (esquerda, direita, inferior, superior, data/hora de início, data/hora de término) e o tamanho espaçotemporal dos pixels (tamanho espacial, duração temporal).</p>
<p>Por exemplo, podemos criar uma view que aplica uma reamostragem dos pixels para 250 m e uma agragação temporal pela mediana de um intervalo mensal para obter uma visão geral da série.</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span> <span style="color:#999;font-style:italic"># Visão geral da cena</span>
</span></span><span style="display:flex;"><span>v.overview = <span style="color:#447fcf">cube_view</span>(
</span></span><span style="display:flex;"><span>  extent=S2_collection, 
</span></span><span style="display:flex;"><span>  dx=<span style="color:#3677a9">250</span>, dy=<span style="color:#3677a9">250</span>, <span style="color:#999;font-style:italic"># 250 m x 250 m</span>
</span></span><span style="display:flex;"><span>  resampling = <span style="color:#ed9d13">&#34;bilinear&#34;</span>, <span style="color:#999;font-style:italic"># interpolador da reamostragem</span>
</span></span><span style="display:flex;"><span>  srs=<span style="color:#ed9d13">&#34;EPSG:31982&#34;</span>, <span style="color:#999;font-style:italic"># projeção de destino</span>
</span></span><span style="display:flex;"><span>  dt=<span style="color:#ed9d13">&#34;P1M&#34;</span>, aggregation = <span style="color:#ed9d13">&#34;median&#34;</span> <span style="color:#999;font-style:italic"># mediana para o mês.</span>
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>v.overview 
</span></span></code></pre></div><pre tabindex="0"><code>## A data cube view object
## 
## Dimensions:
##                low             high count pixel_size
## t       2020-02-01       2020-07-31     6        P1M
## y 7789200.49146679 7900950.49146679   447        250
## x 298688.080453591 410438.080453591   447        250
## 
## SRS: &#34;EPSG:31982&#34;
## Temporal aggregation method: &#34;median&#34;
## Spatial resampling method: &#34;bilinear&#34;
</code></pre><p>A combinação de uma visualização <code>cube_view()</code> da geometria do cubo  com a coleção de imagens produz um cubo de dados raster regular contendo os metadados da coleção de imagens e a geometria da view <code>raster_cube()</code> .</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span> cube.overview &lt;-  <span style="color:#447fcf">raster_cube</span>(S2_collection, v.overview) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> cube.overview
</span></span></code></pre></div><pre tabindex="0"><code>## A data cube proxy object
## 
## Dimensions:
##                low             high count pixel_size chunk_size
## t       2020-02-01       2020-07-31     6        P1M          1
## y 7789200.49146679 7900950.49146679   447        250        320
## x 298688.080453591 410438.080453591   447        250        320
## 
## Bands:
##    name offset scale nodata unit
## 1   AOT      0 1e+00    NaN     
## 2   B01      0 1e-04    NaN     
## 3   B02      0 1e-04    NaN     
## 4   B03      0 1e-04    NaN     
## 5   B04      0 1e-04    NaN     
## 6   B05      0 1e-04    NaN     
## 7   B06      0 1e-04    NaN     
## 8   B07      0 1e-04    NaN     
## 9   B08      0 1e-04    NaN     
## 10  B09      0 1e-04    NaN     
## 11  B11      0 1e-04    NaN     
## 12  B12      0 1e-04    NaN     
## 13  B8A      0 1e-04    NaN     
## 14  SCL      0 1e+00    NaN     
## 15  WVP      0 1e+00    NaN
</code></pre><img src="https://viniciovcl.github.io/viniciovcl/cubos-de-dados-para-an%C3%A1lise-de-s%C3%A9ries-de-imagens-de-sat%C3%A9lite/index_files/figure-html/cubeview_plot-1.png" width="150%" />
<p>A região da cena compreende uma área ocupada predominantemente por pastagens extensivas e reflorestamento de eucalipto. Podemos obter o NDVI da série para e definir uma região específica para observar um povoamento de Eucalyptus Urograndis.</p>
<pre tabindex="0"><code>## Warning in plot.cube(., zlim = c(0, 1200), rgb = 3:1, key.pos = 1, ncol = 1, :
## Ignoring key.pos for RGB plots
</code></pre><img src="https://viniciovcl.github.io/viniciovcl/cubos-de-dados-para-an%C3%A1lise-de-s%C3%A9ries-de-imagens-de-sat%C3%A9lite/index_files/figure-html/euc_rgb-1.png" width="100%" style="display: block; margin: auto;" />
<p>O produto <a href="https://docs.sentinel-hub.com/api/latest/data/sentinel-2-l2a/">L2A</a> inclui bandas de máscara e  sinalizadores de qualidade de pixels, entre outras camadas que podem ser usadas para filtrar pixels espúrios ou atender determinada análise.</p>
<p>As máscaras são aplicadas em imagens e não em cubos. Os valores mascarados não contribuirão para a agregação de pixels.</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>s2.clear.mask &lt;- <span style="color:#447fcf">image_mask</span>(<span style="color:#ed9d13">&#34;SCL&#34;</span>, values= <span style="color:#447fcf">c</span>(<span style="color:#3677a9">0</span>,<span style="color:#3677a9">1</span>,<span style="color:#3677a9">2</span>,<span style="color:#3677a9">3</span>,<span style="color:#3677a9">5</span>,<span style="color:#3677a9">6</span>,<span style="color:#3677a9">7</span>,<span style="color:#3677a9">8</span>,<span style="color:#3677a9">9</span>,<span style="color:#3677a9">10</span>,<span style="color:#3677a9">11</span> )) <span style="color:#999;font-style:italic"># Vegetação</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>v.euc = <span style="color:#447fcf">cube_view</span>(
</span></span><span style="display:flex;"><span>  extent=<span style="color:#447fcf">list</span>(S2_collection, left=<span style="color:#3677a9">321434.9</span>, right=<span style="color:#3677a9">326500</span>,
</span></span><span style="display:flex;"><span>              bottom=<span style="color:#3677a9">7813432</span>, top=<span style="color:#3677a9">7819363</span>,
</span></span><span style="display:flex;"><span>             t0=<span style="color:#ed9d13">&#34;2020-02-15&#34;</span>, t1=<span style="color:#ed9d13">&#34;2020-07-31&#34;</span>),
</span></span><span style="display:flex;"><span>            dt=<span style="color:#ed9d13">&#34;P1M&#34;</span>, dx=<span style="color:#3677a9">100</span>, dy=<span style="color:#3677a9">100</span>, srs=<span style="color:#ed9d13">&#34;EPSG:31982&#34;</span>,
</span></span><span style="display:flex;"><span>            aggregation = <span style="color:#ed9d13">&#34;median&#34;</span>, resampling = <span style="color:#ed9d13">&#34;bilinear&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># NDVI</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>month_euc_ndvi &lt;- <span style="color:#447fcf">raster_cube</span>( S2_collection, v.euc, mask = s2.clear.mask) %&gt;%
</span></span><span style="display:flex;"><span>   <span style="color:#447fcf">select_bands</span>(<span style="color:#447fcf">c</span>(<span style="color:#ed9d13">&#34;B04&#34;</span>,<span style="color:#ed9d13">&#34;B08&#34;</span>, <span style="color:#ed9d13">&#34;SCL&#34;</span>)) %&gt;%
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">apply_pixel</span>(<span style="color:#447fcf">c</span>(<span style="color:#ed9d13">&#34;(B08-B04)/(B08+B04)&#34;</span>), names=<span style="color:#ed9d13">&#34;NDVI&#34;</span>) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># kNDVI</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>month_euc_kndvi &lt;- <span style="color:#447fcf">raster_cube</span>( S2_collection, v.euc, mask = s2.clear.mask) %&gt;%
</span></span><span style="display:flex;"><span>   <span style="color:#447fcf">select_bands</span>(<span style="color:#447fcf">c</span>(<span style="color:#ed9d13">&#34;B04&#34;</span>,<span style="color:#ed9d13">&#34;B04&#34;</span>,<span style="color:#ed9d13">&#34;B08&#34;</span>, <span style="color:#ed9d13">&#34;SCL&#34;</span>)) %&gt;% 
</span></span><span style="display:flex;"><span> <span style="color:#447fcf">apply_pixel</span>(<span style="color:#ed9d13">&#34;tanh(((B08-B04)/(B08+B04))^2)&#34;</span>, <span style="color:#ed9d13">&#34;kNDVI&#34;</span>) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#447fcf">library</span>(viridis)
</span></span><span style="display:flex;"><span>month_euc_ndvi %&gt;%  <span style="color:#447fcf">filter_pixel</span>(<span style="color:#ed9d13">&#34;NDVI &gt; 0.7&#34;</span>) %&gt;% <span style="color:#999;font-style:italic"># filtra outros usos</span>
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">plot</span>(zlim=<span style="color:#447fcf">c</span>(<span style="color:#3677a9">0.55</span>, <span style="color:#3677a9">.9</span>), key.pos=<span style="color:#3677a9">1</span>,  ncol =<span style="color:#3677a9">3</span>, nrow=<span style="color:#3677a9">2</span>, col=viridis)
</span></span></code></pre></div><img src="https://viniciovcl.github.io/viniciovcl/cubos-de-dados-para-an%C3%A1lise-de-s%C3%A9ries-de-imagens-de-sat%C3%A9lite/index_files/figure-html/euc_ndvi-1.png" width="150%" style="display: block; margin: auto;" />
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>month_euc_ndvi %&gt;% <span style="color:#447fcf">filter_pixel</span>(<span style="color:#ed9d13">&#34;NDVI &gt; 0.7&#34;</span>) %&gt;% 
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">reduce_space</span>(<span style="color:#999;font-style:italic">#&#34;sum(NDVI)&#34;,</span>
</span></span><span style="display:flex;"><span>               <span style="color:#ed9d13">&#34;mean(NDVI)&#34;</span>,
</span></span><span style="display:flex;"><span>               <span style="color:#ed9d13">&#34;min(NDVI)&#34;</span>,
</span></span><span style="display:flex;"><span>               <span style="color:#ed9d13">&#34;max(NDVI)&#34;</span>,
</span></span><span style="display:flex;"><span>               <span style="color:#ed9d13">&#34;median(NDVI)&#34;</span>,
</span></span><span style="display:flex;"><span>               <span style="color:#ed9d13">&#34;sd(NDVI))&#34;</span>, 
</span></span><span style="display:flex;"><span>                <span style="color:#ed9d13">&#34;count(NDVI)&#34;</span>, 
</span></span><span style="display:flex;"><span>               <span style="color:#ed9d13">&#34;var(NDVI)&#34;</span>) %&gt;%
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">plot</span>(ncol =<span style="color:#3677a9">4</span>, nrow=<span style="color:#3677a9">2</span>)
</span></span></code></pre></div><img src="https://viniciovcl.github.io/viniciovcl/cubos-de-dados-para-an%C3%A1lise-de-s%C3%A9ries-de-imagens-de-sat%C3%A9lite/index_files/figure-html/reduce_space_ndvi-1.png" width="95%" style="display: block; margin: auto;" />
<p>Os dados do NDVI seguem a tendência esperada para o período seco caracteristico da região para o intervalo analisado. É de se esperar que quanto mais próximo do auge do período seco os fatores climáticos afetem o metabolismo das plantas, resultando em valores menores para o NDVI.</p>
<p>Os <a href="https://tempo.inmet.gov.br/GraficosAnuais">dados do INMET</a> apontam para uma condição típica do clima da região para o período, coincindindo com os mínimos de umidade do ar e longos períodos de estiagem.</p>
<div class="figure" style="text-align: center">
<img src="./images/estao-agua-clara-a756 (6).png" alt="Precipitação (mm) para estação Água Clara (A758)." width="60%" />
<p class="caption">(\#fig:fig_precp_AC)Precipitação (mm) para estação Água Clara (A758).</p>
</div>
<div class="figure" style="text-align: center">
<img src="./images/estao-agua-clara-a756 (2).png" alt="Umidade do ar (%) para estação Água Clara (A758)." width="60%" />
<p class="caption">(\#fig:fig_umid_AC)Umidade do ar (%) para estação Água Clara (A758).</p>
</div>
<div class="figure" style="text-align: center">
<img src="./images/estao-agua-clara-a756 (1).png" alt="Temperatura do ar (ºC) para estação Água Clara (A758)." width="60%" />
<p class="caption">(\#fig:fig_temp_AC)Temperatura do ar (ºC) para estação Água Clara (A758).</p>
</div>
<p>Dado esse contexto, uma pergunta interessante de ser respondida é se:</p>
<p>Mesmo havendo uma tendência global de diminuição do valor do NDVI nos dados analisados, seria possível detectar anomalias da atividade da fotossíntese correspondendo a fatores externos ao clima, como intervenções de manejo ou estresse causado por ventos, pragas e doenças ou fatores fisiológicos da planta?</p>
<p>Ao analisar o comportamento da média e da  mediana no período é possível observar uma atenuação da tendência de diminuição do NDVI no intervalo abril-junho, com uma inflexão no mês de maio.</p>
<div class="figure" style="text-align: center">
<img src="https://viniciovcl.github.io/viniciovcl/cubos-de-dados-para-an%C3%A1lise-de-s%C3%A9ries-de-imagens-de-sat%C3%A9lite/index_files/figure-html/reduce_space_ndvi2-1.png" alt="Média e a mediana da série mensal." width="75%" />
<p class="caption">(\#fig:reduce_space_ndvi2)Média e a mediana da série mensal.</p>
</div>
<h2 id="detecção-de-mudanças">Detecção de mudanças</h2>
<p>Podemos derivar as diferenças mensais para analisar o comportamento da diminuição do valor do NDVI no decorrer dos meses Tt - T (t-1).   A função  <code>window_time()</code>  aplica o filtro de diferença de kernel para a série mensal.</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Diferença mensal</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>month_euc_ndvi %&gt;%  <span style="color:#447fcf">filter_pixel</span>(<span style="color:#ed9d13">&#34;NDVI &gt; 0.7&#34;</span>) %&gt;% 
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">window_time</span>(kernel=<span style="color:#447fcf">c</span>(<span style="color:#3677a9">-1</span>,<span style="color:#3677a9">1</span>), window=<span style="color:#447fcf">c</span>(<span style="color:#3677a9">1</span>,<span style="color:#3677a9">0</span>)) %&gt;%
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">plot</span>(zlim=<span style="color:#447fcf">c</span>(<span style="color:#3677a9">-.13</span>, <span style="color:#3677a9">.15</span>), key.pos=<span style="color:#3677a9">1</span>,   col= viridis,  t = <span style="color:#3677a9">2</span>:<span style="color:#3677a9">6</span>, ncol = <span style="color:#3677a9">3</span> )
</span></span></code></pre></div><img src="https://viniciovcl.github.io/viniciovcl/cubos-de-dados-para-an%C3%A1lise-de-s%C3%A9ries-de-imagens-de-sat%C3%A9lite/index_files/figure-html/euc_change-1.png" width="150%" style="display: block; margin: auto;" />
<div class="figure" style="text-align: center">
<img src="https://viniciovcl.github.io/viniciovcl/cubos-de-dados-para-an%C3%A1lise-de-s%C3%A9ries-de-imagens-de-sat%C3%A9lite/index_files/figure-html/reduce_space_change-1.png" alt="Média e a Mediana da diferença simples para a série mensal Tt - T(t-1)" width="75%" />
<p class="caption">(\#fig:reduce_space_change)Média e a Mediana da diferença simples para a série mensal Tt - T(t-1)</p>
</div>
<p>A média e a mediana da diferença simples mostram uma estagnação da tendência de diminuição do NDVI, com o valor da média da diferença superior a mediana da diferença no mês de junho. Esse comportamento aponta para a diminuição da magnitude da taxa de mudança que pode indicar uma redução na intensidade dessa tendência, o que ser observado no gráfico entre os mêses de maio e junho.</p>
<p>A mudança positiva no intervalo fevereiro-março pode ser decorrente das chuvas que ocorreram durante o período, o que não pode ser observado para o intervalo seguinte mesmo com a continuação de eventos de chuva no mês de abril. Isso poderia estar relacionado a algum &lsquo;fator externo&rsquo; aos dados analisados até aqui?</p>
<p>Observando o gráfico da média e da mediana da diferença podemos considerar três padrões de tendência, representados no gráfico pelos intervalos (1) março-abril, (2) abril-junho, (3) junho-julho.</p>
<p>A inclinação do intervalo (3) junho-julho  é menor que a do intervalo (1) março-abril, o que é contrário a tendência das variáveis climáticas, enquanto a série avança para o auge do período seco do ano, com os mínimos da umidade do ar entre agosto e outubro.</p>
<p>Diferenças abslutas menores do NDVI ocorreram de maneira significativa na área analisada, entre os meses de abril e junho, consecutivamente (maio - abril ; junho - maio). Existe algum padrão ou arranjo espacial dos valores da diferença simples. Orientação preferencial SO-NE?</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>month_euc_ndvi %&gt;%  <span style="color:#447fcf">filter_pixel</span>(<span style="color:#ed9d13">&#34;NDVI &gt; 0.7&#34;</span>) %&gt;% 
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">window_time</span>(kernel=<span style="color:#447fcf">c</span>(<span style="color:#3677a9">-1</span>,<span style="color:#3677a9">1</span>), window=<span style="color:#447fcf">c</span>(<span style="color:#3677a9">1</span>,<span style="color:#3677a9">0</span>)) %&gt;%
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">filter_pixel</span>(<span style="color:#ed9d13">&#34;NDVI &gt; 0.0&#34;</span>) %&gt;% 
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">plot</span>(zlim=<span style="color:#447fcf">c</span>(<span style="color:#3677a9">0.0</span>, <span style="color:#3677a9">.12</span>), key.pos=<span style="color:#3677a9">1</span>,   col= viridis,  t = <span style="color:#3677a9">2</span>:<span style="color:#3677a9">6</span>, ncol = <span style="color:#3677a9">3</span> )
</span></span></code></pre></div><img src="https://viniciovcl.github.io/viniciovcl/cubos-de-dados-para-an%C3%A1lise-de-s%C3%A9ries-de-imagens-de-sat%C3%A9lite/index_files/figure-html/euc_change_filt-1.png" width="150%" style="display: block; margin: auto;" />
<h2 id="considerações-finais">Considerações finais</h2>
<p>Essa análise foi motivada por uma intervenção de manejo em um povoamento adulto de Eucalyptus, realizada no mês de maio, na qual foi empregado um agente como medida de controle sobre a população da Glena bipennaria bipennaria (lagarta desfolhadora).</p>
<p>° Em uma coleção de imagens aplicou-se uma redução temporal da série para um intervalo mensal.</p>
<p>° Foi criado um cubo de dados raster contendo 6 imagens correspondendo ao intervalo mês a mês da série e calculado o índice de vegetação de diferença normalizada NDVI.</p>
<p>° No cubo de dados foi aplicado uma função redutora em uma janela móvel sobre a dimensão do tempo. Filtro de kernel da diferença simples Tt - T (t-1).</p>
<p>A diferença consecutiva mês a mês para o intervalo mostrou uma atenuação na intensidade de tendência de diminuição do NDVI, com inflexões em maio e junho. Uma análise de tendências e anomalias pode fornecer uma abordagem complementar de maneira a validar os valores encontrados para a diferença simples.</p>

    </div>

    
<ul class="list-none pl-0 font-sm align-left">

<hr>
<li class="list-none">
    Categories:
    
    <a class="inline-block mt-2 mr-2 border-none text-neutral-800 dark:text-neutral-200"
       href="/viniciovcl/categories/r">
    <span class="tag-item dark:bg-zinc-900 dark:hover:bg-zinc-700
                 hover:bg-zinc-200 bg-zinc-100
                 dark:border-zinc-600 py-0.5
                 px-1 rounded-t border-b-2 border-zinc-300
                 hover:border-zinc-500">
    R
    </span>
</a>
</li >


<li class="list-none">
    Tags:
    
    <a class="inline-block mt-2 mr-2 border-none text-neutral-800 dark:text-neutral-200"
       href="/viniciovcl/tags/time-series">
        <span class="flex flex-row justify-start items-center
                     dark:bg-zinc-900 dark:hover:bg-zinc-700
                     hover:bg-zinc-300 bg-zinc-200
                     dark:border-zinc-600 py-0.5
                     px-1 rounded-t border-b-2 border-zinc-300
                     hover:border-zinc-500">
            
            <img class="h-4 mr-2 inline" src="https://viniciovcl.github.io/viniciovcl/images/tag_logo.svg"
                 alt="Logo of a tag: indicates that a tag item follows.">
            time-series
        </span>
    </a>
    
    <a class="inline-block mt-2 mr-2 border-none text-neutral-800 dark:text-neutral-200"
       href="/viniciovcl/tags/image-processing">
        <span class="flex flex-row justify-start items-center
                     dark:bg-zinc-900 dark:hover:bg-zinc-700
                     hover:bg-zinc-300 bg-zinc-200
                     dark:border-zinc-600 py-0.5
                     px-1 rounded-t border-b-2 border-zinc-300
                     hover:border-zinc-500">
            
            <img class="h-4 mr-2 inline" src="https://viniciovcl.github.io/viniciovcl/images/tag_logo.svg"
                 alt="Logo of a tag: indicates that a tag item follows.">
            image-processing
        </span>
    </a>
    
    <a class="inline-block mt-2 mr-2 border-none text-neutral-800 dark:text-neutral-200"
       href="/viniciovcl/tags/cube-raster">
        <span class="flex flex-row justify-start items-center
                     dark:bg-zinc-900 dark:hover:bg-zinc-700
                     hover:bg-zinc-300 bg-zinc-200
                     dark:border-zinc-600 py-0.5
                     px-1 rounded-t border-b-2 border-zinc-300
                     hover:border-zinc-500">
            
            <img class="h-4 mr-2 inline" src="https://viniciovcl.github.io/viniciovcl/images/tag_logo.svg"
                 alt="Logo of a tag: indicates that a tag item follows.">
            cube-raster
        </span>
    </a>
    
    <a class="inline-block mt-2 mr-2 border-none text-neutral-800 dark:text-neutral-200"
       href="/viniciovcl/tags/changedetection">
        <span class="flex flex-row justify-start items-center
                     dark:bg-zinc-900 dark:hover:bg-zinc-700
                     hover:bg-zinc-300 bg-zinc-200
                     dark:border-zinc-600 py-0.5
                     px-1 rounded-t border-b-2 border-zinc-300
                     hover:border-zinc-500">
            
            <img class="h-4 mr-2 inline" src="https://viniciovcl.github.io/viniciovcl/images/tag_logo.svg"
                 alt="Logo of a tag: indicates that a tag item follows.">
            changedetection
        </span>
    </a>
    
    <a class="inline-block mt-2 mr-2 border-none text-neutral-800 dark:text-neutral-200"
       href="/viniciovcl/tags/gdalcubes">
        <span class="flex flex-row justify-start items-center
                     dark:bg-zinc-900 dark:hover:bg-zinc-700
                     hover:bg-zinc-300 bg-zinc-200
                     dark:border-zinc-600 py-0.5
                     px-1 rounded-t border-b-2 border-zinc-300
                     hover:border-zinc-500">
            
            <img class="h-4 mr-2 inline" src="https://viniciovcl.github.io/viniciovcl/images/tag_logo.svg"
                 alt="Logo of a tag: indicates that a tag item follows.">
            gdalcubes
        </span>
    </a>
    
    <a class="inline-block mt-2 mr-2 border-none text-neutral-800 dark:text-neutral-200"
       href="/viniciovcl/tags/r-markdown">
        <span class="flex flex-row justify-start items-center
                     dark:bg-zinc-900 dark:hover:bg-zinc-700
                     hover:bg-zinc-300 bg-zinc-200
                     dark:border-zinc-600 py-0.5
                     px-1 rounded-t border-b-2 border-zinc-300
                     hover:border-zinc-500">
            
            <img class="h-4 mr-2 inline" src="https://viniciovcl.github.io/viniciovcl/images/tag_logo.svg"
                 alt="Logo of a tag: indicates that a tag item follows.">
            r-markdown
        </span>
    </a>
    
</li>

</ul>


    

    
    <div class="text-neutral-500 mb-4">
        Last modified <span itemprop="dateModified"
                            datetime="2024-02-18T00:00:00Z"
                            content="2024-02-18T00:00:00Z">
        2024.02.18
        </span>
    </div>
    
</article>

    </main>
    <footer class="footer container h-10 text-center mt-1">
<hr class="my-4">
  <ul class="pl-0 mt-1">
    
    <li class="ml-2 first:before:content-none before:content-['•']
               inline-block list-none">
      <a class="ml-2 text-neutral-800
                dark:text-neutral-400 border-none"
          href="https://github.com/hugcis/hugo-astatine-theme">Code</a>
    </li>
    <li class="ml-2 first:before:content-none before:content-['•']
                text-neutral-800 dark:text-neutral-400 inline-block list-none">
      <span class="ml-2">© viniciovcl 2024</span>
    </li>
  </ul>
</footer>



  </body>
</html>
